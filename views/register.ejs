<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Register</title>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
  <%- include('./layout/styling.ejs') %>
</head>

<body>

  <div class="form-container">
    <h1>Register</h1>

    <div class="form-group">
      <label for="name">Name</label>
      <input type="text" name="name" id="name">
    </div>

    <div class="form-group">
      <label for="email">Email</label>
      <input type="email" name="email" id="email">
    </div>

    <div class="form-group">
      <label for="username">Username</label>
      <input type="text" name="username" id="username">
    </div>

    <div class="form-group">
      <label for="password">Password</label>
      <input type="password" name="password" id="password">
      <div class="show-password">
        <input type="checkbox" id="check">
        <label for="check" id="show">Show Password</label>
      </div>
    </div>
    
    <button id="signin" class="form-button">Sign In</button>
    
    <a href="/" class="form-link">Sudah punya akun? Login</a>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  
  <script>
    // --- SCRIPT LAMA ANDA (SAYA HANYA MENGGANTI ALERT) ---
    const signin = document.getElementById('signin')
    signin.addEventListener('click', () => {
      if (document.getElementById("name").value === "" ||
          document.getElementById('username').value === "" || 
          document.getElementById('password').value === "" || 
          document.getElementById('email').value === "") {
        Swal.fire('Error', 'Harap isi semua kolom', 'warning');
      } else {
        let cek = false
        const data1 = {
          email: document.getElementById('email').value
        }
        axios.post('/api/email', data1)
          .then((response) => {
            Swal.fire('Email Error', 'Email tidak tersedia!', 'error');
            console.log(response)
            cek = false
          })
          .catch(() => {
            cek = true
          })

        const data2 = {
          username: document.getElementById('username').value
        }
        axios.post('/api/username', data2)
          .then((response) => {
            Swal.fire('Username Error', 'Username tidak tersedia!', 'error');
            console.log(response)
            cek = false
          })
          .catch((tersedia) => {
            if (cek === true) {
              const userData = {
                name: document.getElementById('name').value,
                username: document.getElementById('username').value,
                password: document.getElementById('password').value,
                email: document.getElementById('email').value
              };
              axios.post('/api/register', userData)
                .then((response) => {
                  Swal.fire('Registrasi Berhasil!', '', 'success').then(() => {
                    window.location.replace('/');
                  });
                })
                .catch((err) => {
                  Swal.fire('Registrasi Gagal', 'Ada kesalahan: ' + err, 'error');
                  console.log(err);
                });
            }
          })
      }
    })

    const check = document.getElementById('check')

    check.addEventListener('change', () => {
      if (check.checked) {
        document.getElementById('password').type = 'text';
      } else {
        document.getElementById('password').type = 'password';
      }
    })
  </script>
</body>

</html>